# Environment Configuration for Cursor Agent

## Environment Variables
- NODE_ENV=development (or production)
- DATABASE_URL=file:./dev.db (SQLite database path)
- PORT=5173 (default SvelteKit dev server port)

## Node.js Configuration
- Use Node.js 18+ as runtime
- Use npm for package management
- Include `src/` in TypeScript path resolution
- Use SvelteKit for development and building
- Use Prisma for database access and migrations

## Agent Behavior
- Always use npm scripts when available
- Prefer npm commands over direct node/tsc commands
- Use debug logging level for development
- Ensure Node.js environment is properly configured

## Development Environment
- Set NODE_ENV to development for verbose logging
- Use SvelteKit dev server for hot module replacement
- Enable source maps for debugging
- Configure TypeScript strict mode
- SQLite database file in project root (dev.db)
- Prisma migrations in prisma/migrations/

## Command-Specific Environment Requirements

See `.cursor/rules/default-development-workflow.mdc#npm-script-reference` for complete npm script reference.

**Key commands**:
- **NPM**: Always use npm scripts (`npm run dev`, `npm test`, `npm run lint`)
- **TypeScript**: `npm run type-check` (runs `tsc --noEmit`)
- **SvelteKit**: `npm run dev`, `npm run build`, `npm run preview`
- **Prisma**: `npx prisma migrate dev`, `npx prisma studio`, `npx prisma generate`

## NPM Scripts for Environment Management

### Development Lifecycle Commands

Control the application development and build:

- **`npm run dev`** - Start SvelteKit development server (defaults to `http://localhost:5173`)
- **`npm run build`** - Build for production (TypeScript compilation + SvelteKit build)
- **`npm run preview`** - Preview production build locally
- **`npm run type-check`** - Run TypeScript type checking without emitting files
- **`npx prisma migrate dev`** - Create and apply database migrations
- **`npx prisma studio`** - Open Prisma Studio for database browsing

### Testing Commands

Manage test execution:

- **`npm test`** - Run test suite
- **`npm test -- --watch`** - Run tests in watch mode
- **`npm test -- --coverage`** - Run tests with coverage report
- **`npm test -- Game.test.ts`** - Run specific test file
- **`npm test -- -t "should update wave timer"`** - Run tests matching pattern

### Code Quality Commands

Linting, formatting, and type checking:

- **`npm run lint`** - Run ESLint (validation only)
- **`npm run lint -- --fix`** - Run ESLint with auto-fix
- **`npm run format`** - Format code with Prettier
- **`npm run type-check`** - Check TypeScript types (`tsc --noEmit`)

### Package Management Commands

Manage dependencies:

- **`npm install`** - Install dependencies (development)
- **`npm ci`** - Install dependencies from lock file (CI/production)
- **`npm install <package>`** - Install specific package
- **`npm install --save-dev <package>`** - Install dev dependency

## Environment-Specific Configuration

### Development Environment

- **NODE_ENV**: `development`
- **SvelteKit**: Hot module replacement enabled
- **Source Maps**: Enabled for debugging
- **TypeScript**: Strict mode enabled
- **SQLite**: Local database file (dev.db)
- **Prisma**: Client generated from schema
- **Logging**: Verbose console logging

### Production Environment

- **NODE_ENV**: `production`
- **SvelteKit**: Optimized build with minification
- **Source Maps**: Optional (for debugging)
- **TypeScript**: Strict mode enabled
- **SQLite**: Production database file
- **Prisma**: Client generated from schema
- **Logging**: Minimal logging

### Test Environment

- **NODE_ENV**: `test`
- **Vitest**: Test runner configuration
- **Coverage**: Code coverage reporting
- **TypeScript**: Strict mode enabled
- **Logging**: Test-specific logging

## Browser Environment Considerations

### SvelteKit Client-Side

- **Svelte Stores**: Client state management for organization snapshot
- **Server Time Baseline**: Track server time for visual ticking
- **PWA Support**: Service worker for offline caching
- **Local Storage**: Optional for user preferences (reduced motion, high contrast)

### Server-Side Rendering

- **SvelteKit Load Functions**: Server-side data loading
- **API Routes**: Server endpoints for commands and queries
- **Prisma Client**: Database access on server only
- **Deterministic Simulation**: Server-side world advancement

## Performance Considerations

### Development Performance

- **Hot Module Replacement**: Fast iteration during development
- **Source Maps**: Enable for debugging without affecting performance
- **Type Checking**: Run type checking separately from build
- **Prisma Client**: Regenerate after schema changes
- **Database Migrations**: Apply incrementally during development

### Production Performance

- **Code Splitting**: Optimize bundle size
- **Minification**: Reduce bundle size
- **Tree Shaking**: Remove unused code
- **Asset Optimization**: Optimize images and assets

## Accessibility Configuration

### Reduced Motion

- **Media Query**: `(prefers-reduced-motion: reduce)`
- **Implementation**: Replace animations with opacity fades
- **Testing**: Test with reduced motion enabled

### High Contrast

- **Media Query**: `(prefers-contrast: high)`
- **Implementation**: Increase color contrast
- **Testing**: Test with high contrast enabled

## Browser Compatibility

### Target Browsers

- **Modern Browsers**: Chrome, Firefox, Safari, Edge (latest versions)
- **ES2020**: Target ES2020 for modern JavaScript features
- **Canvas API**: Required for rendering
- **Web Audio API**: Required for audio

### Polyfills

- **Not Required**: Modern browsers support required APIs
- **Fallbacks**: Implement graceful degradation if needed

## Development Tools

### VS Code / Cursor Configuration

- **TypeScript**: Use workspace TypeScript version
- **ESLint**: Integrated linting
- **Prettier**: Integrated formatting
- **Debugging**: Source maps enabled

### Browser DevTools

- **Console**: For logging and debugging
- **Performance**: For performance profiling
- **Network**: For asset loading analysis
- **Application**: For local storage inspection

## Environment Validation

### Pre-Development Checks

- **Node.js Version**: Verify Node.js 18+ is installed
- **NPM Version**: Verify npm is up to date
- **Dependencies**: Run `npm install` to ensure dependencies are installed
- **TypeScript**: Verify TypeScript is properly configured
- **Prisma**: Run `npx prisma generate` to ensure Prisma Client is generated
- **Database**: Run `npx prisma migrate dev` to ensure database is up to date

### Pre-Build Checks

- **Type Checking**: Run `npm run type-check` to verify types
- **Linting**: Run `npm run lint` to verify code quality
- **Tests**: Run `npm test` to verify functionality
- **Prisma**: Run `npx prisma generate` to ensure Prisma Client is current
- **Database**: Ensure database migrations are applied
- **Build**: Run `npm run build` to verify production build
